<div class="d-flex justify-content-between align-items-center mb-4">
  <h1><i class="fas fa-tasks"></i> Book Requests Management</h1>
  <span class="badge bg-warning fs-6"><%= @pending_requests.count %> Pending Requests</span>
</div>

<!-- Pending Requests -->
<div class="card mb-4">
  <div class="card-header bg-warning text-dark">
    <h5 class="mb-0"><i class="fas fa-clock"></i> Pending Requests</h5>
  </div>
  <div class="card-body">
    <% if @pending_requests.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Book</th>
              <th>Requested By</th>
              <th>Requested Date</th>
              <th>Needed By</th>
              <th>Reason</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @pending_requests.each do |request| %>
              <tr>
                <td>
                  <strong><%= link_to request.book.title, request.book, class: "text-decoration-none" %></strong>  

                  <small class="text-muted">by <%= request.book.author.name %></small>
                </td>
                <td>
                  <%= request.requested_by.email %>  

                  <small class="text-muted"><%= request.requested_by.role.capitalize %></small>
                </td>
                <td><%= request.requested_date.strftime("%b %d, %Y") %></td>
                <td>
                  <%= request.needed_by_date.strftime("%b %d, %Y") %>
                  <% if request.needed_by_date < Date.current + 3.days %>
                      
<small class="text-danger">Urgent!</small>
                  <% end %>
                </td>
                <td><%= truncate(request.reason, length: 50) %></td>
                <td>
                    <div class="btn-group" role="group">
                        <%= link_to "View", request, class: "btn btn-info btn-sm" %>
                        <% if request.can_be_approved? %>
                        <%= form_with url: approve_book_request_path(request), method: :patch, local: true, style: "display: inline;" do |form| %>
                            <%= form.submit "Approve", class: "btn btn-success btn-sm", 
                                            data: { "turbo-confirm": "Approve this request?" } %>
                        <% end %>
                        <% else %>
                        <span class="btn btn-secondary btn-sm disabled">Book Unavailable</span>
                        <% end %>
                        <%= form_with url: reject_book_request_path(request), method: :patch, local: true, style: "display: inline;" do |form| %>
                        <%= form.submit "Reject", class: "btn btn-danger btn-sm", 
                                        data: { "turbo-confirm": "Reject this request?" } %>
                        <% end %>
                    </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-4">
        <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
        <h4 class="text-success">No Pending Requests</h4>
        <p class="text-muted">All requests have been processed.</p>
      </div>
    <% end %>
  </div>
</div>

<!-- Recent Processed Requests -->
<div class="card">
  <div class="card-header">
    <h5 class="mb-0"><i class="fas fa-history"></i> Recent Processed Requests</h5>
  </div>
  <div class="card-body">
    <% if @recent_requests.any? %>
      <div class="table-responsive">
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Book</th>
              <th>Requested By</th>
              <th>Status</th>
              <th>Processed By</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            <% @recent_requests.each do |request| %>
              <tr>
                <td><%= request.book.title %></td>
                <td><%= request.requested_by.email %></td>
                <td>
                  <span class="badge bg-<%= request.approved? ? 'success' : 'danger' %>">
                    <%= request.status.capitalize %>
                  </span>
                </td>
                <td><%= request.approved_by&.email %></td>
                <td><%= request.approved_date&.strftime("%b %d") %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-muted">No processed requests yet.</p>
    <% end %>
  </div>
</div>
